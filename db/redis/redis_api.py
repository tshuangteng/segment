import redis

from dep.constant import REDIS_HOST, REDIS_PORT, REDIS_PASS


class DbRedis:
    __pool = None

    def __init__(self, redis_host, redis_port, redis_pass, db=1):
        conn_kwargs = {
            'host': redis_host,
            'port': redis_port,
            'password': redis_pass,
            'db': db
        }
        if not self.__pool:
            self.__class__.__pool = redis.ConnectionPool(**conn_kwargs)
        self.__conn = None
        self.__get_conn()

    def __get_conn(self):
        self.__conn = redis.Redis(connection_pool=self.__pool)

    # def get_old_value(self):
    #     self.__conn.

    def close(self):
        self.__conn.close()


def get_old_value(conn, date):
    res_b = conn.get(date) or b"'token': [], 'cookie':[]"
    res_str = str(res_b, encoding='utf8')
    res_dic = eval('{' + res_str + '}')
    return res_dic


def update_value(conn, date, new_dic):
    str_res = str(new_dic).replace('{', '').replace('}', '')
    conn.set(date, str_res)


if __name__ == '__main__':
    # redis_pool = DbRedis(REDIS_HOST, REDIS_PORT, REDIS_PASS)
    # redis_pool.close()

    from datetime import datetime

    # token = 'token demo'
    # cookie = 'cookie demo'
    today_str = datetime.strftime(datetime.now(), '%Y-%m-%d')
    # set_value = f"'token': ['{token}'], 'cookie':['{cookie}']"

    r = redis.Redis(host='localhost', port=6366, db=1, password=REDIS_PASS)
    # res = r.set(today_str, set_value)
    # value = "'token': ['NI31WJ42Fxu', 'AM31mXu2Fxu', 'sX51HdWQGxu'], 'cookie': ['xlly_s=1;cna=ZpD2GPGgjxMCAbRhxwJYttmp;cpcode=YUNDA;_hvn_login=21;accountId=MjIxMDk3NDc2NzgzMA==;tfstk=cDN5BJ6gx3x7d96eaz_2TcHPJglVZw7tuTiuPRaTb26dzDz5iEOZj_Q4KHCwpq1..;TwAhx8HL=C6BCB215B673113B88DEFEF22D0D5CD441D3D197ABA710AE36592A8446521ABFD43983B7DBD97616208343379CCEF5AC719BD1968AF1658B365EB91D6CD2BB39B08F9C4210FF600284675BF02A55AF60CF83B4DB3A4CF9B78A530AA381A16E68CC9E4BD721AEDBB43494709B62E09B0B5999B6F063B080C344FAAFC866B68FDC9BCE8E9FA5968DE81D47C8A70EDC3213B56738F28F4F051F642739E73667008C7708C6E1D6779D77D306470C51667EF2C4062D4DB8C42204CA8156F8AA6323DE900355E5713B3B08FA37514B24548BF10C6E76297700B7A41C4A7CAC384E2FC907CA0434A2CDACB4A6FC13461EB4202E6B15E00DE443FC0921E49666E7D2F852D8F6177797EC27C5914E58AB1446AF7F3696841D8802ADAA374A2A2BEF4785A9766577DF7A86C05743ED136CB4A5BEC90628DE287AA911B99DFCF5D79865A5FEC519DB6E286BF6762A299236AEF05E95E9E0786059EFED07E8076E26942B893310405253327ACC8F2DC81A0D5B8F51AA858D3CD59749A663DBF11667FCDEBB928241C08A488B1A065868B6C42C93A932BF401439014FF77E3AD1861269C04201137FD46938AB6E94717501799AD3941464983874473751AE98437FCB0BFC2F5AD0E3EC63621A4E60F5AB9B98E3826A0609BBBDE63D8B001312B2947FAF8AF4CBFBFE4FDAA872A82F22A513221E21B27D8910BC60306484BF1605C3F217ED0DF72CE6126CE4D49AC7759FEB8F88216C92611467B2A5FBB8B918BC1A1ECF51B49DE7BD60DBB824C65E317D4AB84CF59F12F15397CE94BEC618DA271A36DCC5E168BA075EFFC198D6337225080572588CFEA18A0142625653CA5C26D519922525DDF01C2C0FA2A53981A0A07EDF598FD97A92B6F3AC7F08BB6821602CA1855C2DC28BEAD462D34825B113E6EE42DA7159FFA407B2AE33FA6F49CFB26F78A1E47934822142D447B906FAEFB70F3463513F7066D12DD4291CF3D44673C5F65FE6BE00AD46FC8034AF11998D6434DD1FB038EBCFCFE3F880F4C7E08730E416F69FF830C513D33CC161667288E603C0465C2C313C99D446A97289FCA3D0142C430478EA4E55487BFA393796DA0C7DACC9975178136CA220C95863696C2452EECEC43B02495F43E41BF4E9753051AE309A2B871BC1D513EE7205A1B5FD3705FD8460152008C36F96A24289AE3830085DE4ECEC8E318D50420196A390325ED7BE7303BEA306B7900AF4F21592E2F6B48B7100433D79DD4FF22EF761DE7595C741BFD99686;lvt=1617928819109;cncc=47d6553f28631fb2292e4f89bbd49cbf;SL34syaT=8C5D983BCBE6B9EFC7610EFF8ADB68A1;isLogin=true;account=MTU5NjgxNDkyOTU=;JSESSIONID=4G966G91-11WOWZILX0G25DDUYZCN1-KVM1L9NK-KYS5;tmp0=9CH3RNbH4zC%2BPEFuQc9S2OKfrvAxniRiSB4iDdBZNZBeDs3aNJXdDNxsTk67XXLtv3VJcwPx8o3Rz9dC84A4yfKXebiZJ2orc%2Bq5ZYCatCeVEze%2B5gjoG6afK%2BG6dAK6ErA2e%2FSb84DLe0%2Bl%2FFIdLVkXYUFBzutLVBHl1yv9JVk%3D;isg=BEdHpEjW67HHPm89qz9NzZSv1vsRTBsuh-6XvBk0Y1b9iGdKIRyrfoXKLkjWYPOm;env=null;l=eBSpBhVrjyfedcSLBOfwourza77OSIRAguPzaNbMiOCP_S5D51S1W6ZHOnYkC3GVh6rJR353Gc0bBeYBq7VonxvtRd1lMsHmn', 'xlly_s=1;cna=L5H2GE3tnwYCAbRhxwIshZ8I;cpcode=YUNDA;_hvn_login=21;accountId=MjIxMDkwODAwNDY4NA==;tfstk=cJUcBVZpNooXeHmuAZgbG6-mr2VGZ6_iHPz7zPXosC1ohY4Pia-yXY0cZxD6zh1..;TwAhx8HL=C6BCB215B673113B88DEFEF22D0D5CD441D3D197ABA710AE36592A8446521ABFB1A6C128CFCAE3106F14DF26B98A14AB0CF25C4AF14810012F694BFDBD323EB9B08F9C4210FF600284675BF02A55AF60CF83B4DB3A4CF9B78A530AA381A16E68CC9E4BD721AEDBB43494709B62E09B0B5999B6F063B080C344FAAFC866B68FDC9BCE8E9FA5968DE81D47C8A70EDC3213B56738F28F4F051F642739E73667008C7708C6E1D6779D77D306470C51667EF2C4062D4DB8C42204CA8156F8AA6323DE900355E5713B3B08FA37514B24548BF10C6E76297700B7A41C4A7CAC384E2FC907CA0434A2CDACB4A6FC13461EB4202E6B15E00DE443FC0921E49666E7D2F852D8F6177797EC27C5914E58AB1446AF7F3696841D8802ADAA374A2A2BEF4785A9766577DF7A86C05743ED136CB4A5BEC90628DE287AA911B99DFCF5D79865A5FEC519DB6E286BF6762A299236AEF05E95E9E0786059EFED07E8076E26942B893310405253327ACC8F2DC81A0D5B8F51AA858D3CD59749A663DBF11667FCDEBB928241C08A488B1A065868B6C42C93A932BF401439014FF77E3AD1861269C04201137FD46938AB6E94717501799AD3941464983874473751AE98437FCB0BFC2F5AD0E3EC63621A4E60F5AB9B98E3826A0609BBBDE63D8B001312B2947FAF8AF4CBFBFE4FDAA872A82F22A513221E21B27D8910BC60306484BF1605C3F217ED0DF72CE6126CE4D49AC7759FEB8F88216C92B20C71544C9B8F0F91468F0D491607D619C5BA0E91080D6F8122C8AEDC37B0FDF15397CE94BEC618DA271A36DCC5E168BA075EFFC198D6337225080572588CFEA18A0142625653CA5C26D519922525DDF01C2C0FA2A53981A0A07EDF598FD97A92B6F3AC7F08BB6821602CA1855C2DC28BEAD462D34825B113E6EE42DA7159FFA407B2AE33FA6F49CFB26F78A1E47934FD5B5571E30FDC0010A37F5F017BC01FEE7028CD882B54C8491EB556F2A4F0EFE69E90A72F0D85D8440405E6BCFDBAC8326A2A742E81C948B99251221E1FB713D10C5BAD10FF0C356F6ED8299446183DA1B96D4B4D64FFF2B93DD96EC08B23B6B22ED8C0FC8E2D67630C8EB9A85D3DA4080B2AE728FF14FE47F25581775D78B622D8F5695BD2FED5069B54A1C873D53DD231F426D8F345239BB6F498FA576E88F0B8083A27DFBA82997012B2A8EBD4B18F4E8483896B874D860E98FC0AC1BE5016EF1A8A286B29846A807661050E56D6F86D6CE66EDB476EB43CFA75C49DDC1E;lvt=1617929019911;cncc=2d26a144f9e137008c954325827a6b06;SL34syaT=8C5D983BCBE6B9EFC7610EFF8ADB68A1;isLogin=true;account=MTc2NzQ1NzU1MTk=;JSESSIONID=4G966G91-11WOWZILX0G25DDUYZCN1-KSX5L9NK-55T5;tmp0=9CH3RNbH4zC%2BPEFuQc9S2OKfrvAxniRiSB4iDdBZNZBeDs3aNJXdDNxsTk67XXLtCMdjb5q9lS%2BJvAD%2F6GnnVCVrMwx90d1ebo170EYpjiPrIs2a%2BC4qj%2BXejCrqtdxCN04OjSuAv1yes3dolebKhiWAgk2gD2TpVTPf9IO2HJg%3D;isg=BGpqz_om_kqz-HKmh7fkE3Ydu9AM2-41EpFqx_QjFr1IJwrh3Gs-RbDVs1M712bN;env=null;l=eB_P4wyejyfWNa32BOfwourza77OSIRAguPzaNbMiOCPObfD5nydW6ZH9N8kC3GVh64wR353Gc0bBeYBqSDBuBdxRd1lMsHmn', 'xlly_s=1;branchOverallGuided=1;cna=ruD2GEm2FQgCAd5ILwLPW5Z+;_hvn_login=21;accountId=MjIxMDg4ODgyNzA1OQ==;tfstk=cCIABPMFb7VcpnJRLZUoCDsPPFLOZAN9NxOiX-HfpMdm_BnOi7ShYEUbldNZD8C..;TwAhx8HL=C6BCB215B673113B88DEFEF22D0D5CD441D3D197ABA710AE36592A8446521ABFED77ED465F60BFB656E61F91406A2C91B81689FC71CEA7E3F15964574259497AB08F9C4210FF600284675BF02A55AF60CF83B4DB3A4CF9B78A530AA381A16E68CC9E4BD721AEDBB43494709B62E09B0B5999B6F063B080C344FAAFC866B68FDC9BCE8E9FA5968DE81D47C8A70EDC3213B56738F28F4F051F642739E73667008C7708C6E1D6779D77D306470C51667EF2C4062D4DB8C42204CA8156F8AA6323DE900355E5713B3B08FA37514B24548BF10C6E76297700B7A41C4A7CAC384E2FC93FCBD6DE1AF152B316F9159C67B7C465A7DACDAD75BFE8931C27D51A6C2D54B9831975BBEFEBDA0B0416ED8DF17240264C89A49464AB7CECD31D01F94B5DE04D872389D3710ED11C3D2440B78A1333956EB4F60F7019848E8DD12FCF319B0C99ADC16D5EB5A7891D691BD3974FA5B938C31E4132D7B459144DC52763FDEDB794A8F95482F3F37CFBFC6CB8C714238A506580BDBDAA272B271D8085F9654E79AA03627EBFF4FB0FD52A0DBA9343B3A8030A488975E2EA83F58B8309ECFF900E488EF55C3D25975716C75019B3A81B32F6160E78DA092812D4FE348E37E903A0B63AC57107FB3E60C001D71540921F9002F9E6474E4A167A4CCAC5CF105416F9F7C033EB7D3681FCD151DBC54BC57AF18C170218B8EAE91CAD7282AF8EF750C70C0D20861623C7BDB008E9CEC590BD7C9D266DDB75A7A356C07D94FD04E8E215720DFC0F189FE87527F672C135F6C04A605172A432D15C078CEF15CDD2E7E40C04EEE816321C7E099939E7B6B6DFB0ADBF41D3D197ABA710AE36592A8446521ABFC23EB155F6A181B508F9AEF5F611AE91BBC5381291CEF63291F717F8EF46075CCC1903603984745661C53EC532CE737188C8280B6A54393E9CECF283826320D55F3AE7075A811AB7738A284AC232FC798058A599FE564ECAF95BD35F50CEFA202D80AFE17998DDBAB33BEB9619FA99147BCB3E0624FA059A01365DCDDB8FDC7B55952FF83C8CB1D531A6E49F9D9D43007B5B1B95390DEFBF23521249A78E362E4D15336E38897D2EDA11628A11F59E7D510A921CDF6C285E39AAC0C6969A5B4E956990C1E308C0D72241AFD7EBC333F38ECFCD907556D800456FBF851E6C3A63A877D92858AD79FBDD4D1D778DEE2A595B8EB07A0C51BE5D9477D594B956B6327733E5A81463F7403F70FE3084AFB4C204032BE9BD9CAB7843FD5651950C3E8B;lvt=1617949379240;cncc=ffd98edfc74599ba4383333371a16042;SL34syaT=8C5D983BCBE6B9EFC7610EFF8ADB68A1;cpcode=YUNDA;isLogin=true;account=MTY2MjEzMDkzMTQ=;JSESSIONID=AN566E71-11WOJAJ34G1RG5V5CRBQ2-V4BAX9NK-NBZ5;tmp0=9CH3RNbH4zC%2BPEFuQc9S2AUiAYVtE8DSdqf74D5jZy%2BabCzThLUF66RQ4L0QPiBx1WdnZf5lab04lblNSirH%2BEcPwdiLpSrTmF6Bd87qCbJ6F6PMJUTXoZfrEZPLt2OLdGL4cJ%2FQFgyaObRxV9srUS%2FgaH46VvImZdWUW5nm%2FPE%3D;isg=BAkJaqqQjdclMnEj6YODC0H0GDVjVv2IlYQpAqt-hfAv8ikE86YNWPegMF7EqpXA;env=null;l=eBrw5ld4jyVCb3dEKOfwourza77OSIRAguPzaNbMiOCPO7Cv5PjPW6Zhd7TJC3GNhsQvR353Gc0bBeYBq7VonxvTdJA315Mmn']"
    value = "'token': ['KS51Q5TOHxu', '4S51YyyNHxu'], 'cookie': ['xlly_s=1;branchOverallGuided=1;cna=xwz3GAdj5Q0CAd5ILwIt1jiW;_hvn_login=21;accountId=MjIxMDk2MzEwNjUyMg==;tfstk=cgklBmcOcbPW9DNm1LwSVhbtIlihZR6USvkj3vYVgiS7U-DVic5V9Eeymz4C361..;TwAhx8HL=C6BCB215B673113B88DEFEF22D0D5CD441D3D197ABA710AE36592A8446521ABF951BAD853A794842956576421D7236D5F6A567BC0C3816016AF1817187A55D84B08F9C4210FF600284675BF02A55AF60CF83B4DB3A4CF9B78A530AA381A16E68CC9E4BD721AEDBB43494709B62E09B0B5999B6F063B080C344FAAFC866B68FDC9BCE8E9FA5968DE81D47C8A70EDC3213B56738F28F4F051F642739E73667008C7708C6E1D6779D77D306470C51667EF2C4062D4DB8C42204CA8156F8AA6323DE900355E5713B3B08FA37514B24548BF10C6E76297700B7A41C4A7CAC384E2FC93FCBD6DE1AF152B316F9159C67B7C465A7DACDAD75BFE8931C27D51A6C2D54B9831975BBEFEBDA0B0416ED8DF17240264C89A49464AB7CECD31D01F94B5DE04D872389D3710ED11C3D2440B78A1333956EB4F60F7019848E8DD12FCF319B0C99ADC16D5EB5A7891D691BD3974FA5B938C31E4132D7B459144DC52763FDEDB794A8F95482F3F37CFBFC6CB8C714238A506580BDBDAA272B271D8085F9654E79AA03627EBFF4FB0FD52A0DBA9343B3A8030A488975E2EA83F58B8309ECFF900E488EF55C3D25975716C75019B3A81B32F6160E78DA092812D4FE348E37E903A0B63AC57107FB3E60C001D71540921F9002F9E6474E4A167A4CCAC5CF105416F9F7C033EB7D3681FCD151DBC54BC57AF18C170218B8EAE91CAD7282AF8EF750C70C91F7D8CDD3366FDE547FD17C99063F462CF8F89246D7608999051205CFE1CAC10DFC0F189FE87527F672C135F6C04A605172A432D15C078CEF15CDD2E7E40C04EEE816321C7E099939E7B6B6DFB0ADBF41D3D197ABA710AE36592A8446521ABFC23EB155F6A181B508F9AEF5F611AE91BBC5381291CEF63291F717F8EF46075CCC1903603984745661C53EC532CE7371D39F06C597FF70106FAE0302AF8610C9ABAAB6A959BE93C4AF23D7C923C5A1799379BCA20DE1BD4A8FD8A686FC9DAD6E6A682493A998C81D493D84ACC477B1CB7F477C3D67FA7BEEA0BEFCDCA8DE1967BE4AB9BF7AD75D17A620579B0166C5D92F698C2B69B533E3FD18CDD1976778C02F71FEBBAD32BC720E9E160A6957F931293E718A902D985701059DE650E1AA92F50A9810E19B14AEAC8FF15750185F3300CDC92C70692F80641EA83E1A1014762F06988958A691075DDBC6F9E5CBC985FD7C7B5AF55162650E499F51459CE4E5371804F7BC48F7E65B1800BD94BA61841B32024EEDCAB209C95EBE38032B3606;lvt=1617960661993;cncc=44dbba2610e2f0dd78635534243b91f4;SL34syaT=8C5D983BCBE6B9EFC7610EFF8ADB68A1;cpcode=YUNDA;isLogin=true;account=MTg0Mzg2MjMyMTI=;JSESSIONID=UA866381-B2WOR1UX0UVKY5OJ9MA13-VX404ANK-IQY5;tmp0=9CH3RNbH4zC%2BPEFuQc9S2IU0LlvgmHLNmVnT7sosUfJed%2FFlh9MEk%2FnLgqk%2FDoR422OvAgfRIPFbggDaS4tNNU5HExdbjzMaoGQLakwtdo4yTXQ36MQnwfqtNJPFGyKRxO7D3mlJ7o6gG8XBzybilAMVh6fHFrq0vYwvuW0Xi1c%3D;isg=BN3d5hWhYQyVBQUgEZQgS6pk7LnX-hFM6eB9Pp-iGTRjVv2IZ0ohHKtEhELQlikE;env=null;l=eBTwu_onjyaK2vLLKOfwourza77OSIRAguPzaNbMiOCP9bfv5DO1W6aYY8YJC3GNh6oXR353Gc0bBeYBqSf1M3RudJA315Mmn', 'xlly_s=1;cna=VQz3GPyJCnMCAbRhxwIwhfCQ;cpcode=YUNDA;_hvn_login=21;accountId=MjIxMDk2MzEwNjUyMg==;tfstk=cToPBbbqq3KPd2EBWuZFOZ2_QZ0RZ3ezhiy_rqjVyVGHI-UlixfLhhLg3JMFxzf..;TwAhx8HL=C6BCB215B673113B88DEFEF22D0D5CD441D3D197ABA710AE36592A8446521ABF951BAD853A794842956576421D7236D5F6A567BC0C3816016AF1817187A55D84B08F9C4210FF600284675BF02A55AF60CF83B4DB3A4CF9B78A530AA381A16E68CC9E4BD721AEDBB43494709B62E09B0B5999B6F063B080C344FAAFC866B68FDC9BCE8E9FA5968DE81D47C8A70EDC3213B56738F28F4F051F642739E73667008C7708C6E1D6779D77D306470C51667EF2C4062D4DB8C42204CA8156F8AA6323DE900355E5713B3B08FA37514B24548BF10C6E76297700B7A41C4A7CAC384E2FC907CA0434A2CDACB4A6FC13461EB4202E6B15E00DE443FC0921E49666E7D2F852D8F6177797EC27C5914E58AB1446AF7F3696841D8802ADAA374A2A2BEF4785A9766577DF7A86C05743ED136CB4A5BEC90628DE287AA911B99DFCF5D79865A5FEC519DB6E286BF6762A299236AEF05E95E9E0786059EFED07E8076E26942B893310405253327ACC8F2DC81A0D5B8F51AA858D3CD59749A663DBF11667FCDEBB928241C08A488B1A065868B6C42C93A932BF401439014FF77E3AD1861269C04201137FD46938AB6E94717501799AD3941464983874473751AE98437FCB0BFC2F5AD0E3EC63621A4E60F5AB9B98E3826A0609BBBDE63D8B001312B2947FAF8AF4CBFBFE4FDAA872A82F22A513221E21B27D8910BC60306484BF1605C3F217ED0DF72CE6126CE4D49AC7759FEB8F88216C92916648B77AFF99BA31BF1396337282362011A2A6E46EEAAC17AFD345B5A9EE61F15397CE94BEC618DA271A36DCC5E168BA075EFFC198D6337225080572588CFEA18A0142625653CA5C26D519922525DDF01C2C0FA2A53981A0A07EDF598FD97A92B6F3AC7F08BB6821602CA1855C2DC28BEAD462D34825B113E6EE42DA7159FFA407B2AE33FA6F49CFB26F78A1E47934B9F2B2B335FDB21B2ACCC3A246CCC08E31581059987F26ADDB328CB78B22EC499D28084D0783ED10588F25056E47A6B36004104D1AB6C9BC8ABA5F2676208E92F8591C929A5572CCBCE15170AAF20923BAF9961949D1F3928720B62DBD50962AE7D020F106C2760274B1BBD73F3331E7B715E049B4D41F99F984362022FB747F169E8C7FA2A03B425ED71761B3A9D4563D0429E36A406755E6C73142EFAE1975A7A31A95EC111A82811A92926AEC30F99ADFD98D72705685FEE9BFEAC0986F2B7420D33A82F5B2C0431164637987269B09FE4FD41126E3D3006CDD7F460514A5;lvt=1617960546193;cncc=44dbba2610e2f0dd78635534243b91f4;SL34syaT=8C5D983BCBE6B9EFC7610EFF8ADB68A1;isLogin=true;account=MTg0Mzg2MjMyMTI=;JSESSIONID=UA866381-B2WOR1UX0UVKY5OJ9MA13-PMNX3ANK-2QY5;tmp0=9CH3RNbH4zC%2BPEFuQc9S2IU0LlvgmHLNmVnT7sosUfJed%2FFlh9MEk%2FnLgqk%2FDoR46qmocF6x2UjQRmV4%2FyNCHwdHFzdgb6OOSkLaL9MatAFS5DKwccz%2F%2BiRUiQzZTO28%2FRHXTWBicgxRh04jj2w%2BUntq5W2sde526GFvlg8%2B3oA%3D;isg=BAgI6Z7N_FvgWRDfbOAAwv822XYasWy7vNtIIcK5VAN2nagHasE8S54fEXXtrSST;env=null;l=eBrj8U-Rjyamn-LEKOfwourza77OSIRAguPzaNbMiOCPOzfv5KchW6aYYKTJC3GVh6vWR353Gc0bBeYBqSf1M3RoRd1lMsHmn']"
    r.set('2021-04-08', value)

    old_dict = get_old_value(r, '2021-04-08')
    print(old_dict)

    # old_dict['token'].append('token3')
    # old_dict['cookie'].append('cookie3')
    # update_value(r, today_str, old_dict)
    #
    # r.close()
