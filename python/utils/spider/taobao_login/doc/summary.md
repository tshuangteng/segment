## 菜鸟天地反爬, 持续测试观察的结果总结

### 快递指数行业相关数据  每天大概有5000次请求(不含周,月数据)
	1.突然生产环境linux系统跑的任务,直接失败.
		- 原因: 已稳定运行1年的linux下无界面操作登录验证账号突然失效, 现在linux无界面访问请求后,菜鸟前端没有返回账号密码相关的frame来进行登录操作
		- 解决方案: 部署一台生产环境的Windows系统, 有界面操作的登录验证服务. 获得的数据传送给生产linux即可
            - 未解决  已有的一台生产Windows服务器 对比办公机相同环境部署失败,未找到解决方案.  计划重新申请一台有界面的服务器,Windows或者linux系统

	2.在生产环境有且仅有一个外网ip下, 数据的获取每次请求最少需要6s的间隔时间 
		- 解决方案: 使用动态ip可以解除只有一个外网ip的这个限制,所以本地进行动态代理ip的快速访问测试, 测试结果只能慢速访问, 快速访问直接返回失败.
                   猜测菜鸟的接口请求限制为5s一次, 这样的话使用动态代理ip就没有意义, 目前看来速度问题无解了,只能用一个外网ip慢速访问了.
	        - 已解决

	3.同一账号登录后生成的 *所有* cookies信息和token验证码 都是完全绑定的, 快速访问直接被限制,且一次被限制后,该账号生成的所有验证信息都将失效.
		- 解决方案: 结合问题2,只能使用多账号慢速爬取.
            - 已解决

### 全链路的全国数据   每天大概有8次请求
	已解决: 虽反爬限制很多, 不过共有8次请求, 慢速请求即可,故可以忽略.


### 其他数据  每天大概有13000次请求(不含周,月数据)
	已解决: 通过可用的cookes和token可以并发执行(控制并发的chunk, 间隔30分钟执行并发)


### 总结: 
    重新开发,将登录相关的模块服务部署在有界面的系统并独立化,保存可用的cookies和token即可;
    再根据抓包分析得到其他必要的参数，参照Chrome进行完全模拟的请求爬取数据。
    
    本地测试的环境: Windows系统下登录服务, docker linux系统下数据的爬取任务等.

    结果: 已开发完成,这2天测试本地跑起来很稳定,速度问题目前无解. 待部署验证
    执行时间: 该方案乐观预计需要7个小时左右完成每天的所有数据获取.
    其他问题: 持续观察中


## 动态ip测试总结
    一个外网ip: 只能使用菜鸟天地的一个token,慢速请求不会失败,很稳定. (即使是多账号生成的多token, 也只能使用最近生成的一个token进行单进程慢速请求)
    多个外网ip(动态ip): 使用多token的多进程请求,进程中的每次请求间隔最少5s即可. (必须确保动态ip的稳定性,代理失效的话网络会穿透到本机的ip,就会直接请求失败)